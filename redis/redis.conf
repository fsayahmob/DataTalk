# =============================================================================
# Redis 7 - Configuration Optimisée pour DataTalk
# =============================================================================
# Optimisé pour: Celery broker + Pub/Sub SSE temps réel
# =============================================================================

# -----------------------------------------------------------------------------
# MÉMOIRE
# -----------------------------------------------------------------------------
# Limite mémoire: container 512MB, on réserve 80% pour Redis
maxmemory 400mb

# Politique d'éviction: supprimer les clés avec TTL les plus proches
# (bon pour Celery qui utilise des TTL sur les résultats)
maxmemory-policy volatile-ttl

# -----------------------------------------------------------------------------
# PERFORMANCE RÉSEAU
# -----------------------------------------------------------------------------
# TCP backlog: augmenté pour haute concurrence
tcp-backlog 511

# TCP keepalive: détection des connexions mortes (secondes)
tcp-keepalive 60

# Timeout: 0 = pas de timeout sur les connexions (Pub/Sub longues)
timeout 0

# -----------------------------------------------------------------------------
# PERSISTANCE (optionnel - Celery peut reconstruire les queues)
# -----------------------------------------------------------------------------
# RDB snapshot désactivé (optionnel, on peut perdre quelques tasks si crash)
# save ""

# AOF désactivé (performance > durabilité pour broker)
appendonly no

# -----------------------------------------------------------------------------
# PERFORMANCE GÉNÉRALE
# -----------------------------------------------------------------------------
# Pas de vérification des datasets au démarrage (plus rapide)
activerehashing yes

# Compression des strings (économise mémoire)
# list-compress-depth 0

# Lazy freeing: libérer la mémoire en background (non-bloquant)
lazyfree-lazy-eviction yes
lazyfree-lazy-expire yes
lazyfree-lazy-server-del yes

# -----------------------------------------------------------------------------
# LOGGING
# -----------------------------------------------------------------------------
loglevel notice
